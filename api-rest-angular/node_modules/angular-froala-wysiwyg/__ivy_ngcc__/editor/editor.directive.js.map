{"version":3,"file":"editor.directive.js","sources":["../../.tmp/editor/editor.directive.ts"],"names":[],"mappings":"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","sourcesContent":["import { ControlValueAccessor, NG_VALUE_ACCESSOR } from \"@angular/forms\";\r\nimport { Directive, ElementRef, EventEmitter, Input, NgZone, Optional, Output, Renderer, forwardRef } from '@angular/core';\r\n\r\nimport FroalaEditor from 'froala-editor';\r\n\r\n@Directive({\r\n  selector: '[froalaEditor]',\r\n  exportAs: 'froalaEditor',\r\n  providers: [{\r\n    provide: NG_VALUE_ACCESSOR, useExisting:\r\n      forwardRef(() => FroalaEditorDirective),\r\n    multi: true\r\n  }]\r\n})\r\nexport class FroalaEditorDirective implements ControlValueAccessor {\r\n\r\n  // editor options\r\n  private _opts: any = {\r\n    immediateAngularModelUpdate: false,\r\n    angularIgnoreAttrs: null\r\n  };\r\n\r\n  private _element: any;\r\n\r\n  private SPECIAL_TAGS: string[] = ['img', 'button', 'input', 'a'];\r\n  private INNER_HTML_ATTR: string = 'innerHTML';\r\n  private _hasSpecialTag: boolean = false;\r\n\r\n  // editor element\r\n  private _editor: any;\r\n\r\n  // initial editor content\r\n  private _model: string;\r\n\r\n  private _editorInitialized: boolean = false;\r\n\r\n  private _oldModel: string = null;\r\n\r\n  constructor(el: ElementRef, private zone: NgZone) {\r\n\r\n    let element: any = el.nativeElement;\r\n\r\n    // check if the element is a special tag\r\n    if (this.SPECIAL_TAGS.indexOf(element.tagName.toLowerCase()) != -1) {\r\n      this._hasSpecialTag = true;\r\n    }\r\n    this._element = element;\r\n\r\n    this.zone = zone;\r\n  }\r\n\r\n  // Begin ControlValueAccesor methods.\r\n  onChange = (_) => { };\r\n  onTouched = () => { };\r\n\r\n  // Form model content changed.\r\n  writeValue(content: any): void {\r\n    this.updateEditor(content);\r\n  }\r\n\r\n  registerOnChange(fn: (_: any) => void): void { this.onChange = fn; }\r\n  registerOnTouched(fn: () => void): void { this.onTouched = fn; }\r\n  // End ControlValueAccesor methods.\r\n\r\n  // froalaEditor directive as input: store the editor options\r\n  @Input() set froalaEditor(opts: any) {\r\n    this._opts = opts || this._opts;\r\n  }\r\n\r\n  // froalaModel directive as input: store initial editor content\r\n  @Input() set froalaModel(content: any) {\r\n    this.updateEditor(content);\r\n  }\r\n\r\n  // Update editor with model contents.\r\n  private updateEditor(content: any) {\r\n    if (JSON.stringify(this._oldModel) == JSON.stringify(content)) {\r\n      return;\r\n    }\r\n\r\n    if (!this._hasSpecialTag) {\r\n      this._oldModel = content;\r\n    }\r\n    else {\r\n      this._model = content;\r\n    }\r\n\r\n    if (this._editorInitialized) {\r\n      if (!this._hasSpecialTag) {\r\n        this._editor.html.set(content);\r\n      }\r\n      else {\r\n        this.setContent();\r\n      }\r\n    }\r\n    else {\r\n      if (!this._hasSpecialTag) {\r\n        this._element.innerHTML = content || '';\r\n      }\r\n      else {\r\n        this.setContent();\r\n      }\r\n    }\r\n  }\r\n\r\n  // froalaModel directive as output: update model if editor contentChanged\r\n  @Output() froalaModelChange: EventEmitter<any> = new EventEmitter<any>();\r\n\r\n  // froalaInit directive as output: send manual editor initialization\r\n  @Output() froalaInit: EventEmitter<Object> = new EventEmitter<Object>();\r\n\r\n  // update model if editor contentChanged\r\n  private updateModel() {\r\n    this.zone.run(() => {\r\n\r\n      let modelContent: any = null;\r\n\r\n      if (this._hasSpecialTag) {\r\n\r\n        let attributeNodes = this._element.attributes;\r\n        let attrs = {};\r\n\r\n        for (let i = 0; i < attributeNodes.length; i++) {\r\n\r\n          let attrName = attributeNodes[i].name;\r\n          if (this._opts.angularIgnoreAttrs && this._opts.angularIgnoreAttrs.indexOf(attrName) != -1) {\r\n            continue;\r\n          }\r\n\r\n          attrs[attrName] = attributeNodes[i].value;\r\n        }\r\n\r\n        if (this._element.innerHTML) {\r\n          attrs[this.INNER_HTML_ATTR] = this._element.innerHTML;\r\n        }\r\n\r\n        modelContent = attrs;\r\n      } else {\r\n\r\n        let returnedHtml: any = this._editor.html.get();\r\n        if (typeof returnedHtml === 'string') {\r\n          modelContent = returnedHtml;\r\n        }\r\n      }\r\n      if (this._oldModel !== modelContent) {\r\n        this._oldModel = modelContent;\r\n\r\n        // Update froalaModel.\r\n        this.froalaModelChange.emit(modelContent);\r\n\r\n        // Update form model.\r\n        this.onChange(modelContent);\r\n      }\r\n\r\n    })\r\n  }\r\n\r\n  private registerEvent(eventName, callback) {\r\n\r\n    if (!eventName || !callback) {\r\n      return;\r\n    }\r\n\r\n    if (!this._opts.events) {\r\n      this._opts.events = {};\r\n    }\r\n\r\n    this._opts.events[eventName] = callback;\r\n  }\r\n\r\n  private initListeners() {\r\n    let self = this;\r\n    // Check if we have events on the editor.\r\n    if (this._editor.events) {\r\n      // bind contentChange and keyup event to froalaModel\r\n      this._editor.events.on('contentChanged', function () {\r\n        setTimeout(function () {\r\n          self.updateModel();\r\n        }, 0);\r\n      });\r\n      this._editor.events.on('mousedown', function () {\r\n        setTimeout(function () {\r\n          self.onTouched();\r\n        }, 0);\r\n      });\r\n\r\n      if (this._opts.immediateAngularModelUpdate) {\r\n        this._editor.events.on('keyup', function () {\r\n          setTimeout(function () {\r\n            self.updateModel();\r\n          }, 0);\r\n        });\r\n      }\r\n    }\r\n\r\n    this._editorInitialized = true;\r\n  }\r\n\r\n  private createEditor() {\r\n    if (this._editorInitialized) {\r\n      return;\r\n    }\r\n\r\n    this.setContent(true);\r\n\r\n    // init editor\r\n    this.zone.runOutsideAngular(() => {\r\n      // Add listeners on initialized event.\r\n      if (!this._opts.events) this._opts.events = {}\r\n\r\n      // Register initialized event.\r\n      this.registerEvent('initialized', this._opts.events && this._opts.events.initialized);\r\n      const existingInitCallback = this._opts.events.initialized;\r\n      // Default initialized event.\r\n      if (!this._opts.events.initialized || !this._opts.events.initialized.overridden) {\r\n        this._opts.events.initialized = () => {\r\n          this.initListeners();\r\n          existingInitCallback && existingInitCallback.call(this._editor, this);\r\n        };\r\n        this._opts.events.initialized.overridden = true;\r\n      }\r\n\r\n      // Initialize the Froala Editor.\r\n      this._editor = new FroalaEditor(\r\n        this._element,\r\n        this._opts\r\n      );\r\n    });\r\n  }\r\n\r\n  private setHtml() {\r\n    this._editor.html.set(this._model || \"\");\r\n\r\n    // This will reset the undo stack everytime the model changes externally. Can we fix this?\r\n    this._editor.undo.reset();\r\n    this._editor.undo.saveStep();\r\n  }\r\n\r\n  private setContent(firstTime = false) {\r\n    let self = this;\r\n\r\n    // Set initial content\r\n    if (this._model || this._model == '') {\r\n      this._oldModel = this._model;\r\n      if (this._hasSpecialTag) {\r\n\r\n        let tags: Object = this._model;\r\n\r\n        // add tags on element\r\n        if (tags) {\r\n\r\n          for (let attr in tags) {\r\n            if (tags.hasOwnProperty(attr) && attr != this.INNER_HTML_ATTR) {\r\n              this._element.setAttribute(attr, tags[attr]);\r\n            }\r\n          }\r\n\r\n          if (tags.hasOwnProperty(this.INNER_HTML_ATTR)) {\r\n            this._element.innerHTML = tags[this.INNER_HTML_ATTR];\r\n          }\r\n        }\r\n      } else {\r\n        if (firstTime) {\r\n          this.registerEvent('initialized', function () {\r\n            self.setHtml();\r\n          });\r\n        } else {\r\n          self.setHtml();\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  private destroyEditor() {\r\n    if (this._editorInitialized) {\r\n      this._editor.destroy();\r\n      this._editorInitialized = false;\r\n    }\r\n  }\r\n\r\n  private getEditor() {\r\n    if (this._element) {\r\n      return this._editor;\r\n    }\r\n\r\n    return null;\r\n  }\r\n\r\n  // send manual editor initialization\r\n  private generateManualController() {\r\n    let controls = {\r\n      initialize: this.createEditor.bind(this),\r\n      destroy: this.destroyEditor.bind(this),\r\n      getEditor: this.getEditor.bind(this),\r\n    };\r\n    this.froalaInit.emit(controls);\r\n  }\r\n\r\n  // TODO not sure if ngOnInit is executed after @inputs\r\n  ngAfterViewInit() {\r\n    // check if output froalaInit is present. Maybe observers is private and should not be used?? TODO how to better test that an output directive is present.\r\n    if (!this.froalaInit.observers.length) {\r\n      this.createEditor();\r\n    } else {\r\n      this.generateManualController();\r\n    }\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.destroyEditor();\r\n  }\r\n}\r\n"]}